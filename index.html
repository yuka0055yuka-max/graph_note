<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Graph Note 完全版</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Graph Note 完全版</h1>

    <!-- 日記セクション -->
    <section id="diary-section">
      <h2>日記・メモ</h2>
      <textarea id="diary-text" rows="8" placeholder="ここに日記やメモを書こう..."></textarea>
    </section>

    <!-- グラフセクション -->
    <section id="graph-section">
      <h2>データとグラフ</h2>
      <div class="controls">
        <button onclick="addRow()">行を追加</button>
        <select id="chartTypeSelector" onchange="changeChartType()">
          <option value="bar">棒グラフ</option>
          <option value="line">折れ線グラフ</option>
          <option value="pie">円グラフ</option>
          <option value="radar">レーダーチャート</option>
        </select>
        <button onclick="exportToExcel()">Excel出力</button>
        <button onclick="exportToPDF()">PDF出力</button>
      </div>
      <table id="dataTable">
        <thead>
          <tr>
            <th>項目</th>
            <th>値</th>
            <th>削除</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" value="勉強" oninput="renderChart()"></td>
            <td><input type="number" value="3" oninput="renderChart()"></td>
            <td><button class="delete-btn" onclick="deleteRow(this)">×</button></td>
          </tr>
          <tr>
            <td><input type="text" value="睡眠" oninput="renderChart()"></td>
            <td><input type="number" value="8" oninput="renderChart()"></td>
            <td><button class="delete-btn" onclick="deleteRow(this)">×</button></td>
          </tr>
        </tbody>
      </table>
      <div class="chart-container">
        <canvas id="myChart"></canvas>
      </div>
      <div class="controls">
        <span>平均: <strong id="avg">-</strong></span>
        <span>最大: <strong id="max">-</strong></span>
        <span>最小: <strong id="min">-</strong></span>
      </div>
    </section>

    <!-- 追加機能セクション -->
    <section id="extra-section">
      <h2>追加機能</h2>

      <!-- 共有リンク -->
      <div class="controls">
        <input type="text" id="pinCode" placeholder="PINコードを入力">
        <button onclick="generateShareLink()">共有リンク生成</button>
        <p id="linkResult"></p>
      </div>

      <!-- 音声入力 -->
      <div class="controls">
        <button id="startSpeech">🎤 音声入力</button>
        <p id="speechResult"></p>
      </div>

      <!-- 手書きキャンバス -->
      <div class="controls">
        <canvas id="drawCanvas" width="300" height="200"></canvas>
        <button id="clearCanvas">手書き消去</button>
      </div>
    </section>

    <!-- 保存・履歴・検索 -->
    <section id="history-section">
      <h2>保存・履歴・検索</h2>
      <div class="controls">
        <button id="saveEntry">保存</button>
        <button id="viewHistory">履歴表示</button>
        <input type="text" id="searchWord" placeholder="検索語句">
        <button id="searchBtn">検索</button>
      </div>
      <div id="historyView" style="display:none;">
        <h3>履歴一覧</h3>
        <div id="historyList"></div>
        <button onclick="document.getElementById('historyView').style.display='none'">閉じる</button>
      </div>
    </section>
  </div>

  <script src="script.js"></script>
</body>
</html>